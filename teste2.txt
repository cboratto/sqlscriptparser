/************************
SAFEPAY_ADM.SAFEPAY_CBO
*************************/
CREATE TABLE SAFEPAY_ADM.SAFEPAY_CBO(
  IDT_SAFEPAY_CBO  NUMBER(10,0) NOT NULL,
  COD_SAFEPAY_CBO  VARCHAR2(500)NOT NULL,
  NAM_SAFEPAY_CBO  VARCHAR2(500),
  DAT_CREATION     DATE DEFAULT SYSDATE NOT NULL,
  DAT_UPDATE       DATE DEFAULT SYSDATE NOT NULL,
  NAM_CHANGE_AGENT VARCHAR2(50) DEFAULT USER NOT NULL)
  TABLESPACE TSDSAFEPAY01 INITRANS 6;

-- COMMENTS TABLE
COMMENT ON TABLE SAFEPAY_ADM.SAFEPAY_CBO IS '[PAYSANDU] GRAVA INFORMAÇÕES DO CBO (CÓDIGO BRASILEIRO DE OCUPAÇÃO) FORNECIDAS PELO GOVERNO';
  
-- ADD COMMENTS TO THE COLUMNS
COMMENT ON COLUMN SAFEPAY_ADM.SAFEPAY_CBO.IDT_SAFEPAY_CBO  IS 'PK - SEQUENCE: SQ_SAFECBO_IDT';
COMMENT ON COLUMN SAFEPAY_ADM.SAFEPAY_CBO.COD_SAFEPAY_CBO  IS 'CÓDIGO/DESCRIÇÃO CBO';
COMMENT ON COLUMN SAFEPAY_ADM.SAFEPAY_CBO.NAM_SAFEPAY_CBO  IS 'CÓDIGO/DESCRIÇÃO CBO';
COMMENT ON COLUMN SAFEPAY_ADM.SAFEPAY_CBO.DAT_CREATION     IS 'DATA DE CRIAÇÃO DO REGISTRO';
COMMENT ON COLUMN SAFEPAY_ADM.SAFEPAY_CBO.DAT_UPDATE       IS 'DATA DE ALTERAÇÃO DO REGISTRO';
COMMENT ON COLUMN SAFEPAY_ADM.SAFEPAY_CBO.NAM_CHANGE_AGENT IS 'AUTOR DA ÚLTIMA AÇÃO REALIZADA';

--PK
ALTER TABLE SAFEPAY_ADM.SAFEPAY_CBO ADD CONSTRAINT SAFECBO_PK PRIMARY KEY (IDT_SAFEPAY_CBO) USING INDEX TABLESPACE TSISAFEPAY01;

--UNIQUE
ALTER TABLE SAFEPAY_ADM.SAFEPAY_CBO ADD CONSTRAINT SAFECBO_UK01 UNIQUE (COD_SAFEPAY_CBO) USING INDEX TABLESPACE TSISAFEPAY01;


-- SEQUENCE
CREATE SEQUENCE SAFEPAY_ADM.SQ_SAFECBO_IDT
INCREMENT BY 1
START WITH 1
MAXVALUE 9999999999
MINVALUE 1
CACHE 10
NOORDER;

/************************
SAFEPAY_ADM.SELLER_ACTIVITY
*************************/

CREATE TABLE SAFEPAY_ADM.SELLER_ACTIVITY(
  IDT_SELLER_ACTIVITY         NUMBER(10,0) NOT NULL,
  IDT_SAFEPAY_CNAE            NUMBER(10,0) NULL,
  IDT_SAFEPAY_CBO             NUMBER(10,0) NULL,
  IDT_SAFEPAY_USER            NUMBER(10,0) NOT NULL,
  FLG_MAIN                    NUMBER(1,0)  NOT NULL,
  FLG_ACTIVE                  NUMBER(1,0)  NOT NULL,
  IND_TYPE                    VARCHAR2(4) NOT NULL,
  DAT_CREATION                DATE DEFAULT SYSDATE NOT NULL,
  DAT_UPDATE                  DATE DEFAULT SYSDATE NOT NULL) 
  TABLESPACE TSDSAFEPAY01 INITRANS 6;
  
-- COMMENTS TABLE
COMMENT ON TABLE SAFEPAY_ADM.SELLER_ACTIVITY IS '[PAYSANDU] ELO DE LIGAÇÃO ENTRE O VENDEDOR COM O CBO OU CNAE';

-- ADD COMMENTS TO THE COLUMNS
COMMENT ON COLUMN SAFEPAY_ADM.SELLER_ACTIVITY.IDT_SELLER_ACTIVITY IS 'PK - SEQUENCE: SQ_SELLACTI_IDT';
COMMENT ON COLUMN SAFEPAY_ADM.SELLER_ACTIVITY.IDT_SAFEPAY_CNAE    IS 'FK - TABLE: SAFEPAY_ADM.SAFEPAY_CNAE';
COMMENT ON COLUMN SAFEPAY_ADM.SELLER_ACTIVITY.IDT_SAFEPAY_CBO     IS 'FK - TABLE: SAFEPAY_ADM.SAFEPAY_CBO';
COMMENT ON COLUMN SAFEPAY_ADM.SELLER_ACTIVITY.IDT_SAFEPAY_USER    IS 'FK - TABLE: SAFEPAY_ADM.SAFEUSER_SELLER';
COMMENT ON COLUMN SAFEPAY_ADM.SELLER_ACTIVITY.FLG_MAIN            IS 'INDICA SE O CNAE/CBO É PRINCIPAL OU NÃO, 1 = PRINCIPAL, 2 = SECUNDARIO';
COMMENT ON COLUMN SAFEPAY_ADM.SELLER_ACTIVITY.FLG_ACTIVE          IS 'INDICA SE O REGISTRO ESTÁ ATIVO OU NÃO, 1 = ATIVO, 2 = INATIVO';
COMMENT ON COLUMN SAFEPAY_ADM.SELLER_ACTIVITY.IND_TYPE            IS 'INDICA SE É CBO OU CNAE';
COMMENT ON COLUMN SAFEPAY_ADM.SELLER_ACTIVITY.DAT_CREATION        IS 'DATA DE CRIAÇÃO DO REGISTRO';
COMMENT ON COLUMN SAFEPAY_ADM.SELLER_ACTIVITY.DAT_UPDATE          IS 'DATA DE ALTERAÇÃO DO REGISTRO';

-- PK
ALTER TABLE SAFEPAY_ADM.SELLER_ACTIVITY ADD CONSTRAINT SELLACTI_PK PRIMARY KEY(IDT_SELLER_ACTIVITY) USING INDEX TABLESPACE TSISAFEPAY01;

-- FK SAFEPAY_CNAE
ALTER TABLE SAFEPAY_ADM.SELLER_ACTIVITY ADD CONSTRAINT SAFECNAE_SELLACTI_FK FOREIGN KEY(IDT_SAFEPAY_CNAE)    REFERENCES SAFEPAY_ADM.SAFEPAY_CNAE (IDT_SAFEPAY_CNAE) ENABLE NOVALIDATE;

-- INDEX PARA A FK
CREATE INDEX SAFEPAY_ADM.SELLACTI_IDX01 ON SAFEPAY_ADM.SELLER_ACTIVITY(IDT_SAFEPAY_CNAE) TABLESPACE TSISAFEPAY01 INITRANS 8 ONLINE;
	
-- FK SAFEPAY_CBO
ALTER TABLE SAFEPAY_ADM.SELLER_ACTIVITY ADD CONSTRAINT SAFECBO_SELLACTI_FK FOREIGN KEY (IDT_SAFEPAY_CBO)    REFERENCES SAFEPAY_ADM.SAFEPAY_CBO (IDT_SAFEPAY_CBO) ENABLE NOVALIDATE;

-- INDEX PARA A FK
CREATE INDEX SAFEPAY_ADM.SELLACTI_IDX02 ON SAFEPAY_ADM.SELLER_ACTIVITY(IDT_SAFEPAY_CBO) TABLESPACE TSISAFEPAY01 INITRANS 8 ONLINE;
	
-- FK SAFEUSER_SELLER
ALTER TABLE SAFEPAY_ADM.SELLER_ACTIVITY   ADD CONSTRAINT SAFEUSER_SELLACTI_FK FOREIGN KEY (IDT_SAFEPAY_USER)    REFERENCES SAFEPAY_ADM.SAFEUSER_SELLER (IDT_SAFEPAY_USER) ENABLE NOVALIDATE;

-- INDEX PARA A FK
CREATE INDEX SAFEPAY_ADM.SELLACTI_IDX03 ON SAFEPAY_ADM.SELLER_ACTIVITY(IDT_SAFEPAY_USER) TABLESPACE TSISAFEPAY01 INITRANS 8 ONLINE;
	
-- CK PARA A COLUNA FLG_MAIN
ALTER TABLE SAFEPAY_ADM.SELLER_ACTIVITY   ADD CONSTRAINT SELLACTI_CK01  CHECK (FLG_MAIN IN ('0','1'));

-- CK PARA A COLUNA FLG_ACTIVE
ALTER TABLE SAFEPAY_ADM.SELLER_ACTIVITY  ADD CONSTRAINT SELLACTI_CK02  CHECK (FLG_ACTIVE IN ('0','1'));

-- CK  IND_TYPE
ALTER TABLE SAFEPAY_ADM.SELLER_ACTIVITY  ADD CONSTRAINT SELLACTI_CK03    CHECK (IND_TYPE IN ('CNAE','CBO'));

-- SEQUENCE
CREATE SEQUENCE SAFEPAY_ADM.SQ_SELLACTI_IDT
MINVALUE 1
MAXVALUE 9999999999
START WITH 1
INCREMENT BY 1
CACHE 10
NOORDER;


/************************
SAFEPAY_ADM.ACTIVITY_ACQUIRER_CATEGORY
*************************/

CREATE TABLE SAFEPAY_ADM.ACTIVITY_ACQUIRER_CATEGORY(
             IDT_ACTIVITY_ACQUIRER_CATEGORY NUMBER(10) NOT NULL,
             IDT_SAFEPAY_CNAE               NUMBER(10)  NULL,
			 IDT_SAFEPAY_CBO                NUMBER(10,0) NULL,
             IDT_ACQUIRER_CATEGORY          NUMBER(10,0) NOT NULL,
             FLG_ACTIVE                     NUMBER(1,0)  NOT NULL,
             IND_TYPE                       VARCHAR2(4)  NOT NULL,
             DAT_CREATION                   DATE DEFAULT SYSDATE NOT NULL,
             DAT_UPDATE                     DATE DEFAULT SYSDATE NOT NULL) 
			 TABLESPACE TSDSAFEPAY01 INITRANS 6;

-- COMMENTS TABLE
COMMENT ON TABLE SAFEPAY_ADM.ACTIVITY_ACQUIRER_CATEGORY IS '';

-- ADD COMMENTS TO THE COLUMNS
COMMENT ON COLUMN SAFEPAY_ADM.ACTIVITY_ACQUIRER_CATEGORY.IDT_ACTIVITY_ACQUIRER_CATEGORY IS 'PK - SEQUENCE: SQ_ACTIACQUCATE_IDT';
COMMENT ON COLUMN SAFEPAY_ADM.ACTIVITY_ACQUIRER_CATEGORY.IDT_SAFEPAY_CNAE               IS 'FK - TABLE: SAFEPAY_ADM.SAFEPAY_CNAE';
COMMENT ON COLUMN SAFEPAY_ADM.ACTIVITY_ACQUIRER_CATEGORY.IDT_SAFEPAY_CBO                IS 'FK - TABLE: SAFEPAY_ADM.SAFEPAY_CBO';
COMMENT ON COLUMN SAFEPAY_ADM.ACTIVITY_ACQUIRER_CATEGORY.IDT_ACQUIRER_CATEGORY          IS 'FK - TABLE: SAFEPAY_ADM.ACQUIRER_CATEGORY';
COMMENT ON COLUMN SAFEPAY_ADM.ACTIVITY_ACQUIRER_CATEGORY.FLG_ACTIVE                     IS 'INDICA SE O REGISTRO ESTÁ ATIVO OU NÃO, 1 = ATIVO, 2 = INATIVO';
COMMENT ON COLUMN SAFEPAY_ADM.ACTIVITY_ACQUIRER_CATEGORY.IND_TYPE                       IS 'INDICA SE É CBO OU CNAE';
COMMENT ON COLUMN SAFEPAY_ADM.ACTIVITY_ACQUIRER_CATEGORY.DAT_CREATION                   IS 'DATA DE CRIAÇÃO DO REGISTRO';
COMMENT ON COLUMN SAFEPAY_ADM.ACTIVITY_ACQUIRER_CATEGORY.DAT_UPDATE                     IS 'DATA DE ALTERAÇÃO DO REGISTRO';

-- PK
ALTER TABLE SAFEPAY_ADM.ACTIVITY_ACQUIRER_CATEGORY ADD CONSTRAINT ACTIACQUCATE_PK PRIMARY KEY(IDT_ACTIVITY_ACQUIRER_CATEGORY) USING INDEX TABLESPACE TSISAFEPAY01 ;

-- FK SAFEPAY_CNAE
ALTER TABLE SAFEPAY_ADM.ACTIVITY_ACQUIRER_CATEGORY ADD CONSTRAINT SAFECNAE_ACTIACQUCATE_FK FOREIGN KEY(IDT_SAFEPAY_CNAE)   REFERENCES SAFEPAY_ADM.SAFEPAY_CNAE(IDT_SAFEPAY_CNAE) ENABLE NOVALIDATE;

-- INDEX PARA A FK
CREATE INDEX SAFEPAY_ADM.ACTIACQUCATE_IDX01 ON SAFEPAY_ADM.ACTIVITY_ACQUIRER_CATEGORY(IDT_SAFEPAY_CNAE) TABLESPACE TSISAFEPAY01 INITRANS 8 ONLINE;

-- FK SAFEPAY_CBO
ALTER TABLE SAFEPAY_ADM.ACTIVITY_ACQUIRER_CATEGORY ADD CONSTRAINT SAFECBO_ACTIACQUCATE_FK FOREIGN KEY (IDT_SAFEPAY_CBO)   REFERENCES SAFEPAY_ADM.SAFEPAY_CBO (IDT_SAFEPAY_CBO) ENABLE NOVALIDATE;

-- INDEX PARA A FK
CREATE INDEX SAFEPAY_ADM.ACTIACQUCATE_IDX02 ON SAFEPAY_ADM.ACTIVITY_ACQUIRER_CATEGORY(IDT_SAFEPAY_CBO) TABLESPACE TSISAFEPAY01 INITRANS 8 ONLINE;
	
-- FK ACQUIRER_CATEGORY
ALTER TABLE SAFEPAY_ADM.ACTIVITY_ACQUIRER_CATEGORY   ADD CONSTRAINT ACQUCATE_ACTIACQUCATE_FK FOREIGN KEY (IDT_ACQUIRER_CATEGORY) REFERENCES SAFEPAY_ADM.ACQUIRER_CATEGORY (IDT_ACQUIRER_CATEGORY) ENABLE NOVALIDATE;

-- INDEX PARA A FK
CREATE INDEX SAFEPAY_ADM.ACTIACQUCATE_IDX03 ON SAFEPAY_ADM.ACTIVITY_ACQUIRER_CATEGORY(IDT_ACQUIRER_CATEGORY) TABLESPACE TSISAFEPAY01 INITRANS 8 ONLINE;

-- CK PARA A COLUNA FLG_ACTIVE
ALTER TABLE SAFEPAY_ADM.ACTIVITY_ACQUIRER_CATEGORY ADD CONSTRAINT ACTIACQUCATE_FLGACTI_CK01  CHECK(FLG_ACTIVE IN ('0','1'));

-- CK  IND_TYPE
ALTER TABLE SAFEPAY_ADM.ACTIVITY_ACQUIRER_CATEGORY  ADD CONSTRAINT ACTIACQUCATE_INDTYPE_CK02    CHECK (IND_TYPE IN ('CNAE','CBO'));

-- SEQUENCE
CREATE SEQUENCE SAFEPAY_ADM.SQ_ACTIACQUCATE_IDT
MINVALUE 1
MAXVALUE 9999999999
START WITH 1
INCREMENT BY 1
CACHE 10
NOORDER;

/***********************************
SAFEPAY_ADM.PERSON_EXTERNAL_DATA_CBO
***********************************/
CREATE TABLE SAFEPAY_ADM.PERSON_EXTERNAL_DATA_CBO(
             IDT_PERSON_EXTERNAL_DATA_CBO NUMBER(10) NOT NULL,
             IDT_PERSON_EXTERNAL_DATA     NUMBER(10) NOT NULL,
			 COD_CBO                      VARCHAR2(500),
			 NAM_CBO					  VARCHAR2(500),
			 FLG_MAIN                     NUMBER(1,0) NOT NULL)
			 TABLESPACE TSDSAFEPAY01 INITRANS 6;

-- COMMENTS TABLE
COMMENT ON TABLE SAFEPAY_ADM.PERSON_EXTERNAL_DATA_CBO IS '[PAYSANDU] ';

-- ADD COMMENTS TO THE COLUMNS
COMMENT ON COLUMN SAFEPAY_ADM.PERSON_EXTERNAL_DATA_CBO.IDT_PERSON_EXTERNAL_DATA_CBO IS 'PK - SEQUENCE: SQ_PERSEXTEDATACBO_IDT';
COMMENT ON COLUMN SAFEPAY_ADM.PERSON_EXTERNAL_DATA_CBO.IDT_PERSON_EXTERNAL_DATA     IS 'FK - TABLE: SAFEPAY_ADM.PERSON_EXTERNAL_DATA(IDT_PERSON_EXTERNAL_DATA) ';
COMMENT ON COLUMN SAFEPAY_ADM.PERSON_EXTERNAL_DATA_CBO.COD_CBO                      IS '';
COMMENT ON COLUMN SAFEPAY_ADM.PERSON_EXTERNAL_DATA_CBO.NAM_CBO                      IS '';
COMMENT ON COLUMN SAFEPAY_ADM.PERSON_EXTERNAL_DATA_CBO.FLG_MAIN                     IS '';

-- PK
ALTER TABLE SAFEPAY_ADM.PERSON_EXTERNAL_DATA_CBO ADD CONSTRAINT PERSEXTEDATACBO_PK PRIMARY KEY(IDT_PERSON_EXTERNAL_DATA_CBO) USING INDEX TABLESPACE TSISAFEPAY01 ;


-- FK
DECLARE
  RESOURCE_BUSY EXCEPTION;
  PRAGMA EXCEPTION_INIT(RESOURCE_BUSY, -00054);
  NAOEXECUTOU BOOLEAN := TRUE;
BEGIN
  WHILE NAOEXECUTOU
  LOOP
    BEGIN
      EXECUTE IMMEDIATE 'ALTER TABLE SAFEPAY_ADM.PERSON_EXTERNAL_DATA_CBO ADD CONSTRAINT PERSEXTEDAT_PERSEXTEDATACBO_FK FOREIGN KEY(IDT_PERSON_EXTERNAL_DATA) REFERENCES SAFEPAY_ADM.PERSON_EXTERNAL_DATA(IDT_PERSON_EXTERNAL_DATA) ENABLE NOVALIDATE';
      NAOEXECUTOU := FALSE;
    EXCEPTION
      WHEN RESOURCE_BUSY THEN 
        DBMS_LOCK.SLEEP(SECONDS =>1);
      WHEN OTHERS THEN
        RAISE;
    END;
  END LOOP;
END;
/

-- INDEX PARA A FK
CREATE INDEX SAFEPAY_ADM.PERSEXTEDATACBO_IDX01 ON SAFEPAY_ADM.PERSON_EXTERNAL_DATA_CBO(IDT_PERSON_EXTERNAL_DATA) TABLESPACE TSISAFEPAY01 INITRANS 8 ONLINE;

CREATE INDEX SAFEPAY_ADM.PERSEXTEDATACBO_IDX02 ON SAFEPAY_ADM.PERSON_EXTERNAL_DATA_CBO(COD_CBO) TABLESPACE TSISAFEPAY01 INITRANS 8 ONLINE;

-- SEQUENCE
CREATE SEQUENCE SAFEPAY_ADM.SQ_PERSEXTEDATACBO_IDT
MINVALUE 1
MAXVALUE 9999999999
START WITH 1
INCREMENT BY 1
CACHE 10
NOORDER;



/************************ OS SCRIPTS ABAIXO SÃO REFERENTE A ALTERAÇÃO DAS TABELAS EXISTENTE NO AMBIENTE *************************/

/************************
SAFEPAY_ADM.SAFEPAY_CNAE
*************************/
-- ADD/MODIFY COLUMNS 
ALTER TABLE SAFEPAY_ADM.SAFEPAY_CNAE ADD DAT_UPDATE TIMESTAMP(6);
ALTER TABLE SAFEPAY_ADM.SAFEPAY_CNAE ADD NAM_CHANGE_AGENT VARCHAR2(50);
-- ADD COMMENTS TO THE COLUMNS 
COMMENT ON COLUMN SAFEPAY_ADM.SAFEPAY_CNAE.DAT_UPDATE
  IS 'DATA DE ALTERAÇÃO DO REGISTRO';
COMMENT ON COLUMN SAFEPAY_ADM.SAFEPAY_CNAE.NAM_CHANGE_AGENT
  IS 'AUTOR DA ÚLTIMA AÇÃO REALIZADA';


/************************
SAFEPAY_ADM.COMPANY_EXTERNAL_DATA_CNAE
*************************/
-- ADD/MODIFY COLUMNS 
ALTER TABLE SAFEPAY_ADM.COMPANY_EXTERNAL_DATA_CNAE ADD FLG_MAIN NUMBER(1);
-- ADD COMMENTS TO THE COLUMNS 
COMMENT ON COLUMN SAFEPAY_ADM.COMPANY_EXTERNAL_DATA_CNAE.FLG_MAIN
  IS 'INDICA SE O CNAE É PRINCIPAL OU NÃO. 1-PRINCIPAL 0-SECUNDÁRIO';
  
  
/************************ OS SCRIPTS ABAIXO SÃO REFERENTE CRIAÇÃO DE NOVOS PARAMETROS *************************/
INSERT INTO SAFEPAY_ADM.SAFEPAY_PARAMETER
  (IDT_PARAMETER, NAM_PARAMETER, VAL_PARAMETER, DAT_UPDATE)
VALUES
  (SQ_SAFEPARA_IDT.NEXTVAL, 'DEFAULT_ACQUIRER_CATEGORY', ' ', SYSDATE);

INSERT INTO SAFEPAY_ADM.SAFEPAY_FEATURE_SWITCH
  (IDT_SAFEPAY_FEATURE_SWITCH,
   IND_STATUS,
   NAM_FEATURE,
   NUM_RATE,
   DES_FEATURE,
   NAM_CHANGE_AGENT,
   DAT_CREATION,
   DAT_UPDATE,
   FLG_USER_SWITCHABLE,
   IND_STRATEGY)
VALUES
  (SQ_SAFEFEATSWIT_IDT.NEXTVAL,
   'R',
   'ACQUIRER_CATEGORY_WEB_TRANSACTION',
   NULL,
   'LIGA/DESLIGA USO DO MCC PARA TRANSAÇÕES WEB - PAY-6',
   'SYSTEM',
   SYSDATE,
   SYSDATE,
   1,
   'SBUII');

COMMIT;
